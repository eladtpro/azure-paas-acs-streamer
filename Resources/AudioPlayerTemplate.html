<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Audio Player</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/0.5.14/hls.min.js" integrity="sha512-js37JxjD6gtmJ3N2Qzl9vQm4wcmTilFffk0nTSKzgr3p6aitg73LR205203wTzCCC/NZYO2TAxSa0Lr2VMLQvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/0.5.14/hls.js" integrity="sha512-Uxb1LSW1XkMpEWsi4HguYGAHbXnNP5h0On1bBlSOZmEe42ajm2TCVy6khtfr5jFfjlToaG/mrN6R5zslmOCnAg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>if (!Hls.isSupported())
            console.error("Hls is not supported (hls.js).");
        console.log("Hlsloaded (hls.js)");

        let hlsAudio = document.getElementById("hlsAudio");
        let hlsSource = document.getElementById("hlsSource");
        let fetchHls = document.getElementById("fetchHls");
        let loadUrl = document.getElementById("loadUrl");
        let funcUrl = document.getElementById("funcUrl");
        let blobName = document.getElementById("blobName");

        let hls = new Hls();
        hls.attachMedia(hlsAudio);
        hls.on(Hls.Events.MEDIA_ATTACHED, () => {
            console.log("Audio and hls.js are now bound together !");
            hls.loadSource(hlsSource.value);
        });

        fetchHls.onclick = () => {
            const url = `${funcUrl}&name=${blobName.value}`;
            fetch(url)
                .then((response) => response.json())
                .then((data) => {
                    console.log(data);

                });
        };

        loadUrl.onclick = () => {
            hls.loadSource(hlsSource.value);
        };

        audio.onplay = () => {
            console.log("we can track events the same way with hls.js")
        };

            //text.onchange =</script>
</head>
<body>
    <form>
        <div class="mb-3">
            <input type="text" class="form-control" id="blobName" aria-describedby="blobNameHelp" placeholder="Blob Name" value="Led Zeppelin - Stairway To Heaven (Official Audio).mp3">
            <div id="blobNameHelp" class="form-text">Blob name in the storage container.</div>
        </div>
        <div class="mb-3">
            <input type="text" class="form-control" id="funcUrl" aria-describedby="blobUrlHelp" placeholder="Azure Function Url" value="https://func-ams-media.azurewebsites.net/api/AudioStreamer?code=gHziPP4fxlzLI-Wsru37WW3ne6cptAN4iDQyKkr3JmXoAzFu98se9w==">
            <div id="blobUrlHelp" class="form-text">Azure Function Url.</div>
        </div>
        <div class="mb-3">
            <button type="submit" id="fetchHls" class="btn btn-primary btn-sm">Fetch Hls Source</button>
        </div>
        <div class="mb-3">
            <input type="text" class="form-control" id="hlsSource" aria-describedby="hlsSourceHelp" placeholder="Hls Url">
            <button type="submit" id="loadUrl" class="btn btn-primary btn-sm">Load Player</button>
            <div id="hlsSourceHelp" class="form-text">Hls source stream url.</div>
        </div>
        <div class="mb-3">
            <audio controls id="hlsAudio" preload="meta">
                <source src="http://qthttp.apple.com.edgesuite.net/1010qwoeiuryfg/sl.m3u8" type="application/x-mpegURL" />
            </audio>
        </div>
    </form>
</body>
</html>
